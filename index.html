<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Questions PDF Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-section h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .file-input {
            margin: 10px;
            padding: 10px 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input:hover {
            border-color: #667eea;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
        }

        .settings-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 15px;
        }

        .settings-section h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

        .setting-group input, .setting-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .setting-group input:focus, .setting-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .preview-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 15px;
            background: white;
            min-height: 200px;
        }

        .preview-section h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .question-item {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .question-number {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .question-text {
            margin-bottom: 10px;
            line-height: 1.6;
            color: #333;
        }

        .options {
            margin-left: 20px;
        }

        .option {
            margin-bottom: 3px;
            color: #555;
        }

        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }

        .status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
        }

        .status.error {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }

        .image-preview {
            margin-top: 10px;
            max-width: 200px;
            max-height: 100px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .col {
            flex: 1;
        }

        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“„ Test Questions PDF Generator</h1>
        
        <div class="upload-section">
            <h3>Upload Test Questions File</h3>
            <input type="file" id="questionsFile" class="file-input" accept=".json,.csv" />
            <p style="margin-top: 10px; color: #666; font-size: 14px;">
                Support JSON and CSV formats. JSON should have questions array with question, options, and answer fields.
            </p>
        </div>

        <div class="upload-section">
            <h3>Upload Header & Footer Images (Optional)</h3>
            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                Upload any file type. System will validate if it's a valid image (JPG, JPEG, PNG, GIF, BMP, WEBP).
            </p>
            <div class="row">
                <div class="col">
                    <label for="headerImage">Header Image:</label>
                    <input type="file" id="headerImage" class="file-input" />
                    <img id="headerPreview" class="image-preview" style="display: none;" />
                </div>
                <div class="col">
                    <label for="footerImage">Footer Image:</label>
                    <input type="file" id="footerImage" class="file-input" />
                    <img id="footerPreview" class="image-preview" style="display: none;" />
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h3>PDF Settings</h3>
            <div class="row">
                <div class="col">
                    <div class="setting-group">
                        <label for="title">Test Title:</label>
                        <input type="text" id="title" placeholder="Enter test title" value="Test Questions" />
                    </div>
                </div>
                <div class="col">
                    <div class="setting-group">
                        <label for="fontSize">Font Size:</label>
                        <select id="fontSize">
                            <option value="10">10pt</option>
                            <option value="12" selected>12pt</option>
                            <option value="14">14pt</option>
                            <option value="16">16pt</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="setting-group">
                        <label for="showAnswers">Show Answers:</label>
                        <select id="showAnswers">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                </div>
                <div class="col">
                    <div class="setting-group">
                        <label for="paperSize">Paper Size:</label>
                        <select id="paperSize">
                            <option value="a4">A4 (210 Ã— 297 mm)</option>
                            <option value="letter">Letter (8.5 Ã— 11 inch)</option>
                            <option value="legal">Legal (8.5 Ã— 14 inch)</option>
                            <option value="a3">A3 (297 Ã— 420 mm)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="setting-group">
                        <label for="questionsPerPage">Questions per Page:</label>
                        <input type="number" id="questionsPerPage" value="5" min="1" max="30" />
                        <small style="color: #666; font-size: 12px;">
                            >10 questions = two-column layout automatically
                        </small>
                    </div>
                </div>
                <div class="col">
                    <div class="setting-group">
                        <label for="orientation">Orientation:</label>
                        <select id="orientation">
                            <option value="portrait">Portrait</option>
                            <option value="landscape">Landscape</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="preview-section">
            <h3>Questions Preview</h3>
            <div id="questionsPreview">
                Upload a questions file to see preview...
            </div>
        </div>

        <button id="generateBtn" class="generate-btn" disabled>
            Generate PDF
        </button>
        
        <div id="status" class="status" style="display: none;"></div>
    </div>

    <script>
        let questionsData = [];
        let headerImageData = null;
        let footerImageData = null;

        // File upload handlers
        document.getElementById('questionsFile').addEventListener('change', handleQuestionsFile);
        document.getElementById('headerImage').addEventListener('change', handleHeaderImage);
        document.getElementById('footerImage').addEventListener('change', handleFooterImage);
        document.getElementById('generateBtn').addEventListener('click', generatePDF);

        function handleQuestionsFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                try {
                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(content);
                        questionsData = data.questions || data;
                    } else if (file.name.endsWith('.csv')) {
                        const parsed = Papa.parse(content, {
                            header: true,
                            skipEmptyLines: true,
                            dynamicTyping: true
                        });
                        questionsData = parsed.data.map(row => ({
                            question: row.question || row.Question,
                            options: [row.option1 || row.a, row.option2 || row.b, row.option3 || row.c, row.option4 || row.d].filter(Boolean),
                            answer: row.answer || row.Answer
                        }));
                    }
                    
                    displayPreview();
                    document.getElementById('generateBtn').disabled = false;
                    showStatus('Questions loaded successfully!', 'success');
                } catch (error) {
                    showStatus('Error parsing file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function handleHeaderImage(event) {
            handleImageUpload(event, 'header');
        }

        function handleFooterImage(event) {
            handleImageUpload(event, 'footer');
        }

        function handleImageUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showStatus('Please select a valid image file.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const dataURL = e.target.result;
                const preview = document.getElementById(type + 'Preview');
                
                // Show preview
                preview.src = dataURL;
                preview.style.display = 'block';
                
                // Store image data
                if (type === 'header') {
                    headerImageData = dataURL;
                    console.log('Header image loaded:', file.name, file.type);
                } else {
                    footerImageData = dataURL;
                    console.log('Footer image loaded:', file.name, file.type);
                }
                
                showStatus(`${type.charAt(0).toUpperCase() + type.slice(1)} image loaded successfully!`, 'success');
            };
            
            reader.onerror = function() {
                showStatus(`Error loading ${type} image.`, 'error');
            };
            
            reader.readAsDataURL(file);
        }

        function displayPreview() {
            const preview = document.getElementById('questionsPreview');
            const maxPreview = 3;
            
            if (questionsData.length === 0) {
                preview.innerHTML = 'No questions found in the file.';
                return;
            }

            let html = `<p><strong>Total Questions:</strong> ${questionsData.length}</p>`;
            
            questionsData.slice(0, maxPreview).forEach((q, index) => {
                html += `
                    <div class="question-item">
                        <div class="question-number">Question ${index + 1}:</div>
                        <div class="question-text">${q.question}</div>
                        ${q.options ? `
                            <div class="options">
                                ${q.options.map((option, i) => `
                                    <div class="option">${String.fromCharCode(65 + i)}) ${option}</div>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${q.answer ? `<div style="margin-top: 10px; color: #667eea;"><strong>Answer:</strong> ${q.answer}</div>` : ''}
                    </div>
                `;
            });

            if (questionsData.length > maxPreview) {
                html += `<p style="color: #666; font-style: italic;">... and ${questionsData.length - maxPreview} more questions</p>`;
            }

            preview.innerHTML = html;
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        async function generatePDF() {
            if (questionsData.length === 0) {
                showStatus('Please upload a questions file first.', 'error');
                return;
            }

            const { jsPDF } = window.jspdf;
            
            const settings = {
                title: document.getElementById('title').value || 'Test Questions',
                fontSize: parseInt(document.getElementById('fontSize').value),
                showAnswers: document.getElementById('showAnswers').value === 'true',
                questionsPerPage: parseInt(document.getElementById('questionsPerPage').value),
                paperSize: document.getElementById('paperSize').value,
                orientation: document.getElementById('orientation').value
            };

            console.log('PDF Generation Settings:', settings);
            console.log('Total questions to process:', questionsData.length);

            const doc = new jsPDF(settings.orientation, 'mm', settings.paperSize);
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            const headerHeight = headerImageData ? 25 : 15;
            const footerHeight = footerImageData ? 20 : 15;

            // Determine if we need two columns based on questions per page
            const useColumns = settings.questionsPerPage > 10;
            const columnGap = 10; // Gap between columns
            const columnWidth = useColumns ? (pageWidth - (margin * 2) - columnGap) / 2 : pageWidth - (margin * 2);
            
            console.log(`Layout: ${useColumns ? 'Two columns' : 'Single column'}, Column width: ${columnWidth}mm`);

            // Calculate total pages needed
            const totalPages = Math.ceil(questionsData.length / settings.questionsPerPage);
            console.log(`Total pages needed: ${totalPages} (${questionsData.length} questions Ã· ${settings.questionsPerPage} per page)`);

            // Calculate optimal font size
            let optimalFontSize = calculateOptimalFontSize(settings.questionsPerPage, pageHeight, headerHeight, footerHeight, margin, settings.fontSize, useColumns);
            console.log('Calculated optimal font size:', optimalFontSize);

            // Process each page
            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                console.log(`\n=== Creating Page ${pageNum} ===`);
                
                // Add new page (except for first page)
                if (pageNum > 1) {
                    doc.addPage();
                }
                
                // Determine what to show on this page
                const isFirstPage = pageNum === 1;
                const isLastPage = pageNum === totalPages;
                const showHeader = totalPages === 1 || isFirstPage;
                const showFooter = totalPages === 1 || isLastPage;
                
                console.log(`Page ${pageNum}: showHeader=${showHeader}, showFooter=${showFooter}, useColumns=${useColumns}`);
                
                // Add header and footer
                await addHeaderFooter(doc, pageNum, totalPages, pageWidth, pageHeight, headerHeight, footerHeight, margin, showHeader, showFooter);

                // Calculate starting Y position
                let startY = margin + (showHeader ? headerHeight : 10);

                // Add title on first page only
                if (isFirstPage) {
                    doc.setFontSize(Math.min(18, optimalFontSize + 4));
                    doc.setFont(undefined, 'bold');
                    doc.text(settings.title, pageWidth / 2, startY, { align: 'center' });
                    startY += 15;
                }

                // Calculate which questions go on this page
                const startQuestionIndex = (pageNum - 1) * settings.questionsPerPage;
                const endQuestionIndex = Math.min(startQuestionIndex + settings.questionsPerPage, questionsData.length);
                const questionsForThisPage = questionsData.slice(startQuestionIndex, endQuestionIndex);
                
                console.log(`Page ${pageNum}: Questions ${startQuestionIndex + 1} to ${endQuestionIndex} (${questionsForThisPage.length} questions)`);

                if (useColumns) {
                    // Two-column layout
                    const questionsPerColumn = Math.ceil(questionsForThisPage.length / 2);
                    const leftColumnQuestions = questionsForThisPage.slice(0, questionsPerColumn);
                    const rightColumnQuestions = questionsForThisPage.slice(questionsPerColumn);
                    
                    console.log(`Left column: ${leftColumnQuestions.length} questions, Right column: ${rightColumnQuestions.length} questions`);
                    
                    // Left column
                    let leftY = startY;
                    for (let i = 0; i < leftColumnQuestions.length; i++) {
                        const question = leftColumnQuestions[i];
                        const globalQuestionNum = startQuestionIndex + i + 1;
                        leftY = addQuestionToColumn(doc, question, globalQuestionNum, leftY, margin, columnWidth, settings.showAnswers, optimalFontSize);
                    }
                    
                    // Right column
                    let rightY = startY;
                    const rightColumnX = margin + columnWidth + columnGap;
                    for (let i = 0; i < rightColumnQuestions.length; i++) {
                        const question = rightColumnQuestions[i];
                        const globalQuestionNum = startQuestionIndex + leftColumnQuestions.length + i + 1;
                        rightY = addQuestionToColumn(doc, question, globalQuestionNum, rightY, rightColumnX, columnWidth, settings.showAnswers, optimalFontSize);
                    }
                } else {
                    // Single column layout
                    let currentY = startY;
                    for (let i = 0; i < questionsForThisPage.length; i++) {
                        const question = questionsForThisPage[i];
                        const globalQuestionNum = startQuestionIndex + i + 1;
                        currentY = addQuestionToColumn(doc, question, globalQuestionNum, currentY, margin, columnWidth, settings.showAnswers, optimalFontSize);
                    }
                }

                console.log(`Page ${pageNum} completed with ${questionsForThisPage.length} questions`);
            }

            // Save PDF
            const layoutDescription = useColumns ? "two-column layout" : "single column";
            doc.save(`${settings.title.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`);
            showStatus(`PDF generated successfully! ${totalPages} pages created with ${layoutDescription}. ${settings.questionsPerPage} questions per page.`, 'success');
        }

        function calculateOptimalFontSize(questionsPerPage, pageHeight, headerHeight, footerHeight, margin, baseFontSize, useColumns) {
            // Calculate available content height
            const availableHeight = pageHeight - headerHeight - footerHeight - (margin * 2) - 20; // 20mm for title
            
            // If using columns, we can fit more questions
            const effectiveQuestionsPerColumn = useColumns ? Math.ceil(questionsPerPage / 2) : questionsPerPage;
            
            // Estimate space needed per question based on font size
            // Average question: 2 lines + 4 options (1 line each) + answer (if shown) + spacing
            const linesPerQuestion = 2 + 4 + 1 + 1;
            const mmPerLine = baseFontSize * 0.35; // Tighter line spacing for columns
            const spacePerQuestion = linesPerQuestion * mmPerLine;
            
            const totalSpaceNeeded = effectiveQuestionsPerColumn * spacePerQuestion;
            
            console.log(`Font calculation: ${effectiveQuestionsPerColumn} questions per column need ${totalSpaceNeeded}mm, available: ${availableHeight}mm`);
            
            if (totalSpaceNeeded > availableHeight) {
                // Reduce font size proportionally
                const scaleFactor = availableHeight / totalSpaceNeeded;
                const newFontSize = Math.max(6, Math.floor(baseFontSize * scaleFactor));
                console.log(`Scaling font from ${baseFontSize} to ${newFontSize} (factor: ${scaleFactor.toFixed(2)})`);
                return newFontSize;
            }
            
            return baseFontSize;
        }

        function addQuestionToColumn(doc, question, questionNumber, startY, columnX, columnWidth, showAnswers, fontSize) {
            let currentY = startY;
            const lineHeight = fontSize * 0.35; // Tighter line spacing for better fit
            
            // Set font size
            doc.setFontSize(fontSize);
            
            // Add question (bold)
            doc.setFont(undefined, 'bold');
            const questionText = `${questionNumber}. ${question.question}`;
            const questionLines = doc.splitTextToSize(questionText, columnWidth);
            doc.text(questionLines, columnX, currentY);
            currentY += questionLines.length * lineHeight + 1;

            // Add options (normal, smaller indent for columns)
            if (question.options && question.options.length > 0) {
                doc.setFont(undefined, 'normal');
                const optionIndent = 4; // Smaller indent for columns
                question.options.forEach((option, optIndex) => {
                    const optionText = `${String.fromCharCode(65 + optIndex)}) ${option}`;
                    const optionLines = doc.splitTextToSize(optionText, columnWidth - optionIndent);
                    doc.text(optionLines, columnX + optionIndent, currentY);
                    currentY += optionLines.length * lineHeight + 0.5;
                });
            }

            // Add answer if enabled (highlighted, compact)
            if (showAnswers && question.answer) {
                doc.setFont(undefined, 'bold');
                doc.setFillColor(245, 245, 245);
                const answerText = `Ans: ${question.answer}`;
                const answerWidth = Math.min(doc.getTextWidth(answerText) + 3, columnWidth);
                doc.rect(columnX, currentY - 1, answerWidth, lineHeight + 1, 'F');
                doc.setTextColor(0, 0, 0);
                doc.text(answerText, columnX + 1, currentY);
                currentY += lineHeight + 1;
            }

            // Add space between questions (smaller for columns)
            currentY += 2;
            
            return currentY;
        }

        function estimateQuestionSpace(doc, question, questionNumber, pageWidth, margin, showAnswers, fontSize) {
            // This function is no longer used in the new implementation
            // Keeping for compatibility but the new logic calculates space differently
            return 0;
        }

        async function addHeaderFooter(doc, pageNumber, totalPages, pageWidth, pageHeight, headerHeight, footerHeight, margin, showHeader, showFooter) {
            console.log(`Adding header/footer - Page: ${pageNumber}/${totalPages}, Header: ${showHeader}, Footer: ${showFooter}`);
            
            // Add header image (only on first page or single page)
            if (showHeader && headerImageData) {
                try {
                    console.log('Processing header image...');
                    
                    // Get image format from data URL
                    const formatMatch = headerImageData.match(/data:image\/([^;]+);/);
                    const format = formatMatch ? formatMatch[1].toUpperCase() : 'JPEG';
                    
                    // Handle different image formats
                    let imgFormat = format;
                    if (format === 'JPG') imgFormat = 'JPEG';
                    
                    console.log('Header image format:', imgFormat);
                    
                    // Add image with proper dimensions
                    const imgWidth = pageWidth - (margin * 2);
                    const imgHeight = headerHeight - 5;
                    
                    doc.addImage(headerImageData, imgFormat, margin, 5, imgWidth, imgHeight);
                    console.log('Header image added successfully');
                    
                } catch (error) {
                    console.error('Header image error:', error);
                    showStatus('Header image failed to load in PDF. Using text fallback.', 'error');
                    
                    // Fallback: add text header
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('HEADER', pageWidth / 2, 15, { align: 'center' });
                }
            }

            // Add footer image (only on last page or single page)
            if (showFooter && footerImageData) {
                try {
                    console.log('Processing footer image...');
                    
                    // Get image format from data URL
                    const formatMatch = footerImageData.match(/data:image\/([^;]+);/);
                    const format = formatMatch ? formatMatch[1].toUpperCase() : 'JPEG';
                    
                    // Handle different image formats
                    let imgFormat = format;
                    if (format === 'JPG') imgFormat = 'JPEG';
                    
                    console.log('Footer image format:', imgFormat);
                    
                    // Add image with proper dimensions
                    const imgWidth = pageWidth - (margin * 2);
                    const imgHeight = footerHeight - 5;
                    const yPosition = pageHeight - footerHeight;
                    
                    doc.addImage(footerImageData, imgFormat, margin, yPosition, imgWidth, imgHeight);
                    console.log('Footer image added successfully');
                    
                } catch (error) {
                    console.error('Footer image error:', error);
                    showStatus('Footer image failed to load in PDF. Using text fallback.', 'error');
                    
                    // Fallback: add text footer
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    doc.text('FOOTER', pageWidth / 2, pageHeight - 15, { align: 'center' });
                }
            }

            // Always add page number (on all pages)
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            if (totalPages > 1) {
                doc.text(`Page ${pageNumber} of ${totalPages}`, pageWidth - margin - 25, pageHeight - 5);
            } else {
                doc.text(`Page ${pageNumber}`, pageWidth - margin - 15, pageHeight - 5);
            }
            
            // Always add date/time (on all pages)
            const now = new Date();
            const dateStr = now.toLocaleDateString();
            doc.text(dateStr, margin, pageHeight - 5);
        }
    </script>
</body>
</html>